# Описание

Этот набор обработчиков callback'ов управляет действиями пользователей, связанными с реферальной программой и подарками

### 1. referrals_info

#### Назначение:

Обработчик для callback'а, который предоставляет информацию о рефералах пользователя, включая количество приглашенных друзей и ссылку для реферала.

#### Действия:

1. Логирует начало обработки запроса на информацию о рефералах.
2. Извлекает данные пользователя из базы данных.
3. Генерирует ссылку для реферала на основе ID пользователя.
4. Рассчитывает количество приглашенных рефералов.
5. Формирует сообщение с количеством рефералов и ссылкой для приглашений.
6. Отправляет обновленное сообщение с реферальной ссылкой и количеством рефералов, используя клавиатуру с управлением рефералами.

#### Используемые компоненты:

- **`logger`**: Для логирования событий и действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`ReferralDAO`**: Для получения информации о рефералах пользователя.
- **`translations`**: Для формирования сообщения с учетом языка пользователя(не используется).
- **`settings`**: Для генерации реферальной ссылки.
- **`get_referral_keyboard`**: Для создания клавиатуры с возможностью управления рефералами.
### 2. referrals_btn

#### Назначение:

Обработчик для callback'а, который отправляет пользователю информацию о реферальной программе и предоставляет возможность использовать реферальные кнопки.

#### Действия:

1. Логирует событие клика по кнопке рефералов.
2. Извлекает данные пользователя из базы данных.
3. Генерирует реферальную ссылку для пользователя.
4. Отправляет сообщение с текстом о реферальной программе и кнопками для использования рефералов.

#### Используемые компоненты:

- **`logger`**: Для логирования действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`translations`**: Для формирования текста сообщения с учетом языка пользователя.(не используется)
- **`settings`**: Для получения информации о реферальной ссылке.
- **`get_btn_referral_keyboard`**: Для создания клавиатуры с кнопками для использования рефералов.
### 3. gift_type

#### Назначение:

Обработчик для callback'а, который запрашивает у пользователя выбор типа подарка, предоставляя клавиатуру для дальнейших действий.

#### Действия:

1. Логирует начало запроса на выбор типа подарка.
2. Извлекает данные пользователя.
3. Отправляет пользователю сообщение с предложением выбрать тип подарка и отображает соответствующую клавиатуру.

#### Используемые компоненты:

- **`logger`**: Для логирования действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`translations`**: Для формирования сообщения с учетом языка пользователя.(не используется)
- **`get_gift_type_keyboard`**: Для создания клавиатуры с выбором типа подарка.
### 4. open_gift

#### Назначение:

Обработчик для callback'а, который предоставляет информацию о возможных планах и ценах, если пользователь решит открыть подарок.

#### Действия:

1. Логирует запрос на открытие подарка.
2. Извлекает данные пользователя.
3. Отправляет информацию о стоимости планов и их вариантах для подарка.

#### Используемые компоненты:

- **`logger`**: Для логирования действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`translations`**: Для формирования сообщения с учетом языка пользователя.(не используется)
- **`get_gift_plans_kb`**: Для создания клавиатуры с планами для подарков.
### 5. personal_gift

#### Назначение:

Обработчик для callback'а, который запрашивает у пользователя персональные данные (например, имя) для оформления персонального подарка.

#### Действия:

1. Логирует запрос на персональный подарок.
2. Извлекает данные пользователя.
3. Запрашивает у пользователя информацию (например, имя) для подарка.
4. Изменяет состояние пользователя и отправляет сообщение с инструкциями для ввода.

#### Используемые компоненты:

- **`logger`**: Для логирования действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`translations`**: Для формирования сообщения с учетом языка пользователя.(не используется)
- **`bot.set_state`**: Для установки состояния пользователя для дальнейшего ввода.
- **`get_return_to_gift_type_kb`**: Для создания клавиатуры для возврата к выбору типа подарка.
### 6. recharge_balance (gift-invoice)

#### Назначение:

Обработчик для callback'а, который обрабатывает пополнение баланса для подарков и создает платежные ссылки для пользователей, которые хотят подарить подписку другому пользователю.

#### Действия:

1. Логирует запрос на пополнение баланса для подарка.
2. Извлекает данные о выбранном плане и пользователе, которому будет подарена подписка.
3. Генерирует уникальный платежный ID.
4. Добавляет информацию о платеже в базу данных.
5. Создает ссылку на оплату для подарка и отправляет информацию пользователю.

#### Используемые компоненты:

- **`logger`**: Для логирования действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`ReferralDAO`**: Для получения информации о рефералах (если это необходимо).
- **`PaymentDAO`**: Для добавления записи о платеже в базу данных.
- **`create_invoice`**: Для генерации платежной ссылки.
- **`translations`**: Для формирования сообщения с учетом языка пользователя.(не используется)
- **`settings`**: Для получения информации о ценах планов.
### 7. referrals_stat

#### Назначение:

Обработчик для callback'а, который предоставляет статистику о рефералах пользователя, включая количество рефералов, количество подписанных и платящих пользователей.

#### Действия:

1. Логирует запрос на статистику по рефералам.
2. Извлекает данные пользователя и информацию о рефералах.
3. Рассчитывает статистику по общему количеству рефералов, подписавшихся пользователей и платящих рефералов.
4. Формирует сообщение с статистикой и отправляет его пользователю.

#### Используемые компоненты:

- **`logger`**: Для логирования действий пользователя.
- **`UserDAO`**: Для получения данных о пользователе.
- **`ReferralDAO`**: Для получения статистики по рефералам.
- **`translations`**: Для формирования сообщения с учетом языка пользователя.(не используется)