## Общая информация

**handle_new_post** — асинхронная функция, которая обрабатывает новое сообщение в канале, включая текст и медиафайл. Функция фильтрует сообщения по ключевым словам, сокращает текст, проверяет рекламу, и отправляет сообщения подписанным пользователям в зависимости от их настроек.

## Что принимает?

- **w_id** (int): Идентификатор рабочего процесса для логирования.
- **tg_client** (TelegramClient): Объект клиента для взаимодействия с Telegram API.
- **event** (Event): Объект события, представляющий новое сообщение в чате.
- **for_user** (int, optional): Идентификатор пользователя, если нужно обработать сообщение для конкретного пользователя (по умолчанию `None`).

## Логика работы

1. **Обработка групповых сообщений**:
    - Если сообщение является частью медиагруппы, проверяется, было ли оно уже обработано.
    - Если сообщение не обработано, оно добавляется в список обработанных.
2. **Получение информации о канале**:
    - Извлекается информация о канале (название и username).
    - Проверяется наличие канала в базе данных.
    - Если канал не найден, происходит выход из канала для рабочих процессов, кроме первого.
3. **Обработка текста и медиа**:
    - Вызывается функция **process_message** для обработки текста и медиа.
    - Если медиа — это фото, проверяется наличие рекламы с помощью функции **advertisment_recognizer**.
    - Если текст или медиа содержат стоп-слова, они исключаются.
4. **Получение подписанных пользователей**:
    - Извлекаются пользователи, подписанные на канал, и разделяются по типам (с ChatGPT или без, с медиа или без).
5. **Сокращение текста с помощью ChatGPT**:
    - Для пользователей с включенной функцией ChatGPT текст сокращается с помощью **get_shortened_text**.
    - Если текст слишком длинный или схож с предыдущими новостями, сообщение не отправляется.
6. **Отправка сообщений подписчикам**:
    - В зависимости от настроек пользователя (с медиа или без), отправляется соответствующее сообщение с текстом и/или медиа.
7. **Очистка файлов**:
    - После обработки медиафайлов вызывается функция **remove_files** для их удаления.

## Возвращаемые значения

Функция не возвращает значения, так как выполняет побочные эффекты — обработку сообщений, отправку уведомлений и очистку ресурсов.