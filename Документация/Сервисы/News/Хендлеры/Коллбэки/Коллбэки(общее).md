### Назначение

Обработчики команд в этом модуле реализуют действия при нажатии пользователем кнопок в интерфейсе бота, управляют состоянием пользователя и обновляют контент в чатах.
### Структура

Каждый обработчик взаимодействует с определенной кнопкой и выполняет действия в зависимости от состояния пользователя или команды. Обработчики используют `telebot` для работы с Telegram API и базы данных SQLAlchemy для хранения состояния пользователей.
### Функции и обработчики

## 1. toggle_media2

- **Назначение**: Переключение флага отображения медиа-контента для пользователя.
- **Действия**:
    - Переключает значение флага `media_flag` пользователя.
    - Обновляет кнопку с текстом в зависимости от состояния флага.
    - Логирует событие и отправляет обновленную кнопку в чат.
- **Используемые компоненты**:
    - `UserEventDAO.create_user_event` для записи события.
    - `translations` для перевода текста.
    - `bot.edit_message_reply_markup` для обновления кнопки.
## 2. toggle_similar
- **Назначение**: Переключение фильтра похожих новостей.
- **Действия**:
    - Проверяет наличие премиум-подписки у пользователя.
    - Переключает флаг фильтра похожих новостей.
    - Логирует изменение и обновляет интерфейс пользователя.
- **Используемые компоненты**:
    - `UserDAO.check_subscribe` для проверки подписки.
    - `generate_settings_menu_keyboard` для обновления интерфейса.
    - `translations` для сообщений об ошибке.
### 3. toggle_media(1 версия)

- **Назначение**: Переключение флага показа медиа-материалов.
- **Действия**:
    - Проверяет подписку пользователя и обновляет флаг `media_flag`.
    - Логирует событие и обновляет меню пользователя.
- **Используемые компоненты**:
    -`generate_settings_menu_keyboard` для обновления интерфейса.
    - `UserDAO.check_subscribe` для проверки подписки.
### 4. toggle_channel_up

- **Назначение**: Переключение флага канала для пользователя.
- **Действия**:
    - Переключает флаг `channel_up` пользователя.
    - Логирует изменения и обновляет меню канала.
- **Используемые компоненты**:
    - `generate_channels_menu_keyboard` для обновления интерфейса.
### 5. toggle_recommendation

- **Назначение**: Переключение флага рекомендаций для пользователя.
- **Действия**:
    - Проверяет подписку пользователя и переключает флаг `recommendation_flag`.
    - Логирует событие и обновляет меню настроек.
- **Используемые компоненты**:
    - `generate_settings_menu_keyboard` для обновления интерфейса.
### 6. toggle_chatgpt

- **Назначение**: Переключение флага использования ChatGPT.
- **Действия**:
    - Проверяет подписку и состояние дайджеста, затем переключает флаг `chatgpt_flag`.
    - Обновляет медиафайл профиля пользователя.
    - Логирует событие и обновляет интерфейс с изображением.
- **Используемые компоненты**:
    - `update_image` для обновления изображения профиля.
    - `generate_settings_menu_keyboard` для обновления интерфейса.
### 7. account

- **Назначение**: Отображение аккаунта пользователя с обновленным профилем.
- **Действия**:
    - Загружает и отображает основное меню с персонализированным изображением профиля.
    - Логирует запрос и отправляет ответ пользователю.
- **Используемые компоненты**:
    - `generate_main_menu_keyboard` для формирования меню.
    - `update_image` для обновления изображения.
### 8. pay_subscribe

- **Назначение**: Платеж за подписку.
- **Действия**:
    - Проверяет наличие подписки и отображает опции для подписки (ежемесячная или ежегодная).
    - Логирует информацию о подписке.
    - Отправляет текст с деталями подписки и кнопками выбора.
- **Используемые компоненты**:
    - `InlineKeyboardButton` для создания кнопок подписки.
    - `translations` для локализации текста.(не используется)
### 9. set_language(не используется)

- **Назначение**: Установка языка для пользователя.
- **Действия**:
    - Изменяет язык пользователя в базе данных и вызывает отправку приветственного сообщения.
- **Используемые компоненты**:
    - `send_welcome` для отправки приветственного сообщения.
### 10. digest
- **Назначение**: Включение режима дайджеста.
- **Действия**:
    - Активирует режим дайджеста и отправляет информацию с обновленным меню.
- **Используемые компоненты**:
    - `generate_digest_keyboard` для формирования клавиатуры.
### 11. digest_off

- **Назначение**: Отключение режима дайджеста.
- **Действия**:
    - Отключает режим дайджеста и сбрасывает `digest_time`.
    - Отправляет обновленное сообщение.
- **Используемые компоненты**:
    - `digest_off_scheduler` для сброса таймера дайджеста.
    - `generate_digest_keyboard` для обновления интерфейса.
### 12. get_now

- **Назначение**: Получение дайджеста в текущий момент.
- **Действия**:
    - Отправляет дайджест пользователю.
- **Используемые компоненты**:
    - `send_digest` для отправки дайджеста.
### 13. handle_callback_query (channels_page_)

- **Назначение**: Обработка пагинации страниц канала.
- **Действия**:
    - Переход к следующей или предыдущей странице списка каналов.
    - Отправка обновленного списка каналов пользователю.
- **Используемые компоненты**:
    - `generate_channel_list` для формирования списка каналов.
### 14. start_btn

- **Назначение**: Обработка нажатия кнопки старт.
- **Действия**:
    - Отправляет пользователю сообщение приветствия, выполняя команду `/start`.
- **Используемые компоненты**:
    - `send_welcome` для отправки приветственного сообщения.
#### 15. handle_subscription
- **Назначение**: Обработка обновлений рекомендаций для пользователя.
- **Действия**:
    - Обновляет рекомендации для указанной категории (например, "наши каналы" или другая категория если найдена).
- **Используемые компоненты**:
    - `generate_our_recommendation_keyboard` и `generate_recommendation_keyboard` для обновления интерфейса.
#### 16. handle_second_mes_pagination

- **Назначение**: Пагинация видео-сообщений в процессе подписки.
- **Действия**:
    - Загружает видео и текст, отображая их в зависимости от выбранной страницы.
    - Логирует действия пользователя.
- **Используемые компоненты**:
    - `upload_video` для загрузки видео.
### Общие особенности

1. **Логирование**: Все обработчики логируют действия пользователей для дальнейшего анализа и улучшения функционала.
2. **Подписка**: Для большинства функций, таких как фильтрация новостей, рекомендации или использование ChatGPT, проверяется наличие активной премиум-подписки.
3. **Переводы**: Все сообщения и уведомления генерируются с учетом языка пользователя, что позволяет поддерживать локализацию для различных языков.
4. **Интерактивность**: Все команды сопровождаются интерактивными кнопками для управления состоянием и перехода между различными интерфейсами.
# В будущем будет переработано