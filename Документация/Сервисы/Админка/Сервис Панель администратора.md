
**Для управления данными пользователей, подписками, каналами, запросами к OpenAI и аналитикой реализована панель администратора на базе Django. Панель обеспечивает удобный доступ к данным бота и предоставляет гибкие возможности для фильтрации, сортировки, аналитики и управления.**
## Основные возможности

### 1. Статистика (home):

**URL: /  
views.py::home()**

Главная страница (`home`) отображает ключевые метрики:

- Общее количество пользователей (`User.objects.count()`).
- Пользователи с пробной подпиской (вычисляются через аннотацию Exists для оплаченных счетов).
- Активные подписчики (определяются как пользователи с `ban_date=None`).
- Графики:
	- `stats.get_paid_chart()` — анализ дохода.
	- `stats.get_active_chart()` — активные пользователи.
	- `stats.get_pro_chart()` — пользователи с подпиской.(планы MONTHLY, YEARLY, GIFT, REFERRAL_PAID)
	- `stats.get_new_exit_chart` — **График ушедших / пришедших пользователей:** отображает динамику регистрации и блокировок бота

Реализовано через подзапросы ORM (Subquery, OuterRef, Exists) и сторонние функции из stats.py.

### 2. Управление пользователями (UserListView):

**URL: /users/**
Класс представления `UserListView` предоставляет:

- **Поиск**: По `username, first_name, user_id` с использованием `Q()` и фильтра icontains.
- **Фильтры**:
	- `search` — поиск по имени, ID, названию или ссылке.
	- `plan` — фильтрация по типу подписки (`trial, paid, month, year, expired`(ушедшие платные)).
	- `ordering` — сортировка данных.
	- `utm` — фильтрация по источнику регистрации.
	- `per_page` — количество записей на странице.
    
- **Сортировка**: По -`created_at` (новые пользователи сверху) или параметру GET-запроса ordering.
- **Пагинация**: Настройка через параметр `per_page`.
- **Аннотации**:
	- Количество подписок на каналы через `Subquery`.
	- Тип последней подписки через `Subquery`.  

### 3. Управление каналами (ChannelListView):

**URL: /channels/**
- Класс `ChannelListView`:
	- Отображает список каналов с:
		- Количеством подписчиков (аннотация `Count('channel_link')`).
		- Названием и ссылкой на канал.
		- Привязкой к воркерам.
	- Поддерживает поиск по названию или ссылке канала (`icontains`).

URL: /channles/<channel_id>/
- Класс `ChannelDetailView`:
	- Показывает пользователей, подписанных на конкретный канал и краткую информацию о канале  

### 4. Детальная информация о пользователе (UserInfoView):

**URL: /users/<user_id>/**
- Функция представления `user_info`():
	- Выводит данные пользователя через `get_object_or_404`.
	- Отображает:
		- Список каналов пользователя с количеством подписчиков каждого канала.
		- Покупки пользователя.
	- Логика поиска каналов:
		- Аннотации с `Count и Subquery`.

### 5. Управление воркерами (WorkerListView):

**URL: /workers/**
- Класс `WorkerListView`:
	- Отображает список воркеров и их состояние.
	- Стандартная пагинация и фильтрация.  

### 6.  Авторизация:

**URL: /login/**
- Реализована через стандартные классы Django:
	- `Login` (наследуется от `LoginView`) — для авторизации.
	- `logout_view`() — для выхода из системы.
	- Для защиты доступа используется декоратор `@login_required` и `LoginRequiredMixin`.**

### 7. График затрат пользователей на запросы к OpenAI:

**URL: /openaicost/**
- Класс `OpenAiCostListView`:
- Страница отображает общую сумму затрат пользователей на запросы к OpenAI.
- **Фильтры по датам:**
	- `date_start` и `date_end` — фильтры по диапазону дат (например, для запросов к OpenAI).
- **Сортировка по наибольшей сумме запросов:**
	- Список пользователей отсортирован по сумме запросов.
- Реализовано через запросы ORM с агрегацией (Sum) и фильтрацией по дате.**

### 8. История покупок пользователя (InvoiceListView):

**URL: /invoices/**
- Для каждого пользователя отображается история его покупок:
	- Тип подписки (недельная, месячная, годовая).
	- Дата создания подписки.
	- Статус (`paid` или `pending`).
	- Фильтр по статусу (status):  
	    - По умолчанию, Оплаченные подписки  
	    - `all`, Все подписки, даже не оплаченные
- Реализовано через связанные запросы ORM (`ForeignKey` на модель `Invoice`).

****

### Методы представлений

- `home()` — отображение статистики.
- `UserListView.get_queryset()` — обработка фильтров, аннотаций и поиска.
- `UserInfoView.get_object(`) — получение объекта пользователя.
- `ChannelListView.get_queryset()` — группировка каналов и подсчёт подписчиков.
- `get_paid_subscribers_by_date()` — получение подписчиков с оплаченной подпиской по указанной дате.
****

### Структура URL

- `/` — главная страница статистики (home).
- `/login/` — авторизация (Login).
- `/logout/` — выход из системы (logout_view).
- `/users/` — список пользователей (UserListView).
- `/users/<user_id>/` — детальная информация о пользователе (UserInfoView).
- `/channels/` — список каналов (ChannelListView).
- `/channels/<channel_id>/` — пользователи канала (ChannelDetailView).
- `/workers/` — список воркеров (WorkerListView).
- `/invoices/` — список покупок (InvoiceListView).
- /openaicots/ — топ пользователей по тратам токенов (OpenAiCostListView).**