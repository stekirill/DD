## 1. Обработка голосовых сообщений

**Эндпоинт:** `@register_message_handler(content_types=["voice"])`  
**Состояние:** Требуется активный стейт (после `/search`)
### Логика работы:
1. Распознавание речи через ASR-сервис
2. Обработка запроса через GPT
3. Маршрутизация ответа:
    - **Дайджест**: `digest-тема`
    - **Поиск**: `search-ключевые_слова`
    - **Произвольный ответ**: прямая отправка
**Особенности:**
- Автоматическое удаление промежуточных сообщений
- Поддержка Markdown в ответах(на данный момент)
- Таймаут обработки: 30 сек
## 2. Обработка подарков (username)

**Состояние:** `GiftUserStates.waiting_for_username` 

**Активация:** После выбора "Персональный подарок"
### Валидация имени:

1. Удаление `@` в начале
2. Проверка на:
    - Спецсимволы
    - Пробелы
    - Совпадение с отправителем
**Ошибки:**
- `gift_username_invalid` - неверный формат
- `gift_username_self_error` - попытка самоподарка
## 3. Обработка ключевых слов
**Состояние:** `UserWordStates.waiting_for_word`  
**Контекст:** Добавление фильтров к каналу
**Особенности:**
- Регистронезависимое хранение
- Максимум 5 фраз на канал
- Автоматическая тримминг пробелов
## 4. Создание рубрик

**Состояние:** `AddRubricStates.waiting_for_rubric_name`  
**Лимиты:**

- Пагинация по 10 рубрик на пользователя
**Интеграция:**
1. Создание рубрики
2. Привязка к существующим подпискам
3. Генерация клавиатуры управления
## 5. Обработка медиаконтента

**Поддерживаемые типы:**
- Текст
- Фото/Видео
- Документы
- Голосовые/Видеосообщения
## 6. Производительность

**Бенчмарки:**

|Действие|Время (мс)|
|---|---|
|ASR|1200 ± 200|
|GPT|2500 ± 500|
|Поиск|300 ± 50|
|Ответ|100 ± 20|